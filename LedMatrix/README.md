# LedMatrix

## Схема
![image](https://github.com/user-attachments/assets/22dd17e1-5fd4-4038-abb0-b978f6457360)

## Таблица

<table>
  <tbody><tr>
    <th>leds</th>
    <th>pin7</th>
    <th>pin8</th>
    <th>pin11</th>
    <th>pin12</th>
  </tr>
  <tr>
    <td>1</td>
    <td>H</td>
    <td>L</td>
    <td>L</td>
    <td>H</td>
  </tr>
  <tr>
    <td>2</td>
    <td>H</td>
    <td>L</td>
    <td>H</td>
    <td>L</td>
  </tr>
  <tr>
    <td>3</td>
    <td>L</td>
    <td>H</td>
    <td>L</td>
    <td>H</td>
  </tr>
  <tr>
    <td>4</td>
    <td>L</td>
    <td>H</td>
    <td>H</td>
    <td>L</td>
  </tr>
  <tr>
    <td>1,2</td>
    <td>H</td>
    <td>L</td>
    <td>L</td>
    <td>L</td>
  </tr>
  <tr>
    <td>3,4</td>
    <td>L</td>
    <td>H</td>
    <td>L</td>
    <td>L</td>
  </tr>
  <tr>
    <td>1,3</td>
    <td>H</td>
    <td>H</td>
    <td>L</td>
    <td>H</td>
  </tr>
  <tr>
    <td>2,4</td>
    <td>H</td>
    <td>H</td>
    <td>H</td>
    <td>L</td>
  </tr>
  <tr>
    <td>1,4</td>
    <td colspan="4">switch 1/4</td>
  </tr>
  <tr>
    <td>2,3</td>
    <td colspan="4">switch 2/3</td>
  </tr>
  <tr>
    <td>1,2,3</td>
    <td colspan="4">switch 1,2/3</td>
  </tr>
  <tr>
    <td>2,3,4</td>
    <td colspan="4">switch 2,4/3</td>
  </tr>
  <tr>
    <td>1,3,4</td>
    <td colspan="4">switch 3,4/1</td>
  </tr>
  <tr>
    <td>1,2,4</td>
    <td colspan="4">switch 2,4/1</td>
  </tr>
  <tr>
    <td>1,2,3,4</td>
    <td>H</td>
    <td>H</td>
    <td>L</td>
    <td>L</td>
  </tr>
  <tr>
    <td>ниодного</td>
    <td>L</td>
    <td>L</td>
    <td>L</td>
    <td>L</td>
  </tr>
</tbody></table>


## Возможности:

* Управление четырьмя светодиодами, подключенными к выводам 3, 4, 5 и 6 микроконтроллера Arduino.
* Управление осуществляется через последовательный порт, с помощью текстовых команд.
* Поддержка различных комбинаций включения/выключения светодиодов, задаваемых пользователем.


## Функционал:

Программа считывает текстовые команды с последовательного порта, интерпретирует их и управляет четырьмя светодиодами на плате Arduino. Каждая команда соответствует определённой конфигурации включения/выключения светодиодов. Программа использует библиотеку ArduinoJson для хранения и доступа к таблице соответствий. Предусмотрена функция паузы для разделения последовательности состояний.


## Основные компоненты кода:

1. Заголовочные файлы:
   - `#define PIN_LED_3 3`, `#define PIN_LED_4 4`, `#define PIN_LED_5 5`, `#define PIN_LED_6 6`: Определяют пины микроконтроллера, к которым подключены светодиоды.
   - `#include <ArduinoJson.h>`: Подключает библиотеку ArduinoJson для работы с данными в формате JSON.

2. Глобальные переменные:
   - `String inputText;`: Переменная для хранения вводимой пользователем строки с командой.
   - `String ledState;`: Переменная для хранения 8-битного кода, определяющего состояние светодиодов.
   - `StaticJsonDocument<200> bincode;`: Объект типа `StaticJsonDocument` из библиотеки ArduinoJson, используется для хранения таблицы соответствия между текстовыми командами и кодами состояний светодиодов. Размер буфера `200` указывает на максимальный размер данных JSON, которые могут быть сохранены.
   - `unsigned long previousMillis = 0;`: Переменная для отслеживания времени, используется в функции `pause`.
   - `bool isPaused = false;`: Флаг, указывающий на то, приостановлена ли программа.


3. Функция `pause(unsigned long duration)`: 

   Создает задержку в работе программы на заданное время `duration` в миллисекундах. Используется для обеспечения видимого переключения светодиодов. Реализация использует цикл `while`, который блокирует выполнение кода до истечения заданного времени.

4. Функция `parcer(String ledState)`: 

   Эта функция является сердцем программы. Она принимает строку `ledState` (8-битный код в виде строки), разбирает её на две 4-битные части (`val1` и `val2`), и устанавливает состояние каждого светодиода с помощью функции `digitalWrite()`. Каждый бит в коде соответствует одному светодиоду: 1 - включен, 0 - выключен. Функция вызывает `pause()` для создания задержки между переключением первой и второй 4-битных частей кода.

5. Функция `setup()`: 

   Функция инициализации. Здесь происходит инициализация последовательного порта (`Serial.begin(9600)`), вывод приветственного сообщения, заполнение объекта `bincode` данными о соответствии команд и состояний светодиодов (используется литерал JSON), а также настройка пинов светодиодов как выходов (`pinMode(PIN_LED_..., OUTPUT)`).

7. Функция `loop()`: 

   Основной цикл программы. Она постоянно проверяет наличие данных в последовательном порте (`Serial.available() > 0`). Если данные есть, она считывает строку (`Serial.readStringUntil('\n')`), проверяет её наличие в `bincode` и, если команда найдена, вызывает функцию `parcer()` для установки состояния светодиодов. В случае ошибки выводится сообщение. В конце `loop` вызывается `parcer` для повторной отправки `ledState` (чтобы светодиоды постоянно горели при стабильном состоянии), при условии что `ledState` не пустой.


## Работа программы:

Программа запускается на Arduino. После инициализации, она выводит приглашение ввести команду в последовательный порт. Пользователь вводит команду (например, "1,3" для включения первого и третьего светодиода). Программа проверяет, существует ли такая команда в таблице `bincode`. Если команда найдена, программа извлекает соответствующий 8-битовый код, устанавливает состояние светодиодов и выводит информацию в последовательный порт. Если команда не найдена, выводится сообщение об ошибке. После обработки команды, программа ожидает следующую команду. Временная задержка между переключениями состояний светодиодов, обеспечивает видимое изменение состояния.
