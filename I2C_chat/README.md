# I2C_chat

[ссылка на tinkercad](https://www.tinkercad.com/things/8fxZSXfPdOp/editel?returnTo=%2Fdashboard%2Fdesigns%2Fcircuits)

Этот скетч реализует простую систему обмена сообщениями между Arduino-устройствами по шине I2C. Каждое устройство имеет свой адрес, может принимать сообщения от других и передавать их по запросу.

## Назначение

* Устройство с этим кодом принимает и отправляет сообщения другим Arduino по I2C.
* Пользователь вводит адрес получателя и текст сообщения через Serial-монитор.
* Прием сообщений и ответы на запросы обрабатываются асинхронно через I2C-прерывания.

## Используемые библиотеки

```cpp
#include <Wire.h>
```

## Основные переменные

* `myadress`: I2C-адрес текущего устройства (по умолчанию `49`)
* `adress`: адрес получателя сообщения
* `message`: сообщение для отправки
* `state`: флаг состояния (0 — ожидание, 1 — передать адрес, 2 — передать сообщение)
* `resetadress`: таймер сброса адреса после неактивности

## Логика работы

### `setup()`

* Инициализация I2C с заданным адресом.
* Назначение обработчиков `onReceive()` и `onRequest()`.
* Инициализация последовательного соединения.

### `loop()`

1. **Ввод адреса получателя**:

   * Если адрес не задан, ожидается ввод с Serial.
   * Проверяется, чтобы адрес был допустимым (в пределах 49–51, не равен самому себе).
2. **Ввод сообщения**:

   * При вводе символов формируется строка `message`.
   * Если с момента ввода адреса прошло более 6 секунд без ввода сообщения, адрес сбрасывается.

### `receiveEvent()`

* При получении данных по I2C:

  * `"a"` → устройство должно передать адрес получателя.
  * `"m"` → устройство должно передать сообщение.
  * Любой другой ввод интерпретируется как новое входящее сообщение от другого устройства. Сообщение отображается в Serial.

### `requestEvent()`

* Возвращает:

  * длину сообщения (если `state == 0`)
  * адрес получателя (если `state == 1`)
  * само сообщение (если `state == 2`)

## Пример взаимодействия

1. Устройство A (адрес 49) запускается и ожидает ввод.
2. Пользователь вводит адрес получателя (например, `50`) и сообщение через Serial.
3. Сообщение сохраняется в буфере.
4. Устройство B (адрес 50) запрашивает у A данные по I2C:

   * Сначала — длину сообщения
   * Затем — адрес
   * Затем — само сообщение
5. Сообщение отображается в Serial на устройстве B.

## Примечания

* Поддерживается только адреса 49, 50, 51.
* После 6 секунд бездействия адрес сбрасывается.
* Используется последовательное соединение для пользовательского ввода и отображения сообщений.


